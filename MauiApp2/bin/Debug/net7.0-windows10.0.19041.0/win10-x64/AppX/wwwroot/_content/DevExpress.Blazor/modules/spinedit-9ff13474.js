import{_ as e}from"./_tslib-6e8ca86b.js";import{b as t,d as n}from"./dom-25ebd160.js";import{k as o}from"./key-1994c54c.js";import{E as i}from"./eventhelper-8570b930.js";import{C as s}from"./custom-events-helper-18f7786a.js";import{s as r}from"./constants-4c28185b.js";import{n as a}from"./nameof-factory-64d95f5b.js";import{DxMaskedInputEditor as l,MaskProcessingMode as d}from"./masked-input-3ac6865f.js";import{C as u}from"./css-classes-f3f8ed66.js";import{M as p,B as m}from"./mask-controller-315bd234.js";import{e as h}from"./property-d3853089.js";import"./text-editor-1a26e95f.js";import"./dx-ui-element-39d22b67.js";import"./logicaltreehelper-ec583f1d.js";import"./layouthelper-910ca836.js";import"./rect-6159d026.js";import"./point-37917280.js";import"./lit-element-base-c6695e09.js";import"./data-qa-utils-8be7c726.js";import"./lit-element-70cf14f4.js";import"./input-0a93ae45.js";import"./custom-element-267f9a21.js";import"./disposable-d2c2d283.js";import"./dom-utils-304c8c50.js";class c extends CustomEvent{constructor(e,t){super(c.eventName,{detail:new b(e,t),bubbles:!0,composed:!0,cancelable:!0})}}c.eventName=r+".incrementValue";class b{constructor(e,t){this.Increment=e,this.PreviousValue=t}}var v,w;s.register(c.eventName,(e=>e.detail)),function(e){e.allowMouseWheel="allow-mouse-wheel",e.needExponentialView="need-exponential-view",e.useAdaptiveLayout="use-adaptive-layout",e.decimalSeparator="decimal-separator"}(w||(w={}));const f=a();class B{}v=B,B.Prefix=u.Prefix+"-spin",B.BtnsContainer=v.Prefix+"-btns",B.IncBtn=v.Prefix+"-btn-inc",B.DecBtn=v.Prefix+"-btn-dec";class y extends l{constructor(){super(...arguments),this.regex=/^-?(\d)*$/,this.pointerDownTimer={id:-1,button:null},this.buttonObserver=new MutationObserver(this.buttonRemovedHandler.bind(this)),this.boundButtonOnPointerDownHandler=this.onButtonPointerDown.bind(this),this.boundButtonOnPointerUpHandler=this.onButtonPointerUp.bind(this),this.allowMouseWheel=!1,this.needExponentialView=!1,this.useAdaptiveLayout=!1}get pointerDownTimerId(){return this.pointerDownTimer.id}get shouldProcessFocusOut(){return!this.fieldElement||!this.fieldElement.hasAttribute(p.suppressFocusEvents)}get shouldProcessWheel(){return this.allowMouseWheel}connectedCallback(){if(this.useAdaptiveLayout=this.useAdaptiveLayout||t.Browser.MobileUI,this.useAdaptiveLayout){const e=Array.from(this.querySelectorAll(`.${B.BtnsContainer}`));for(const t of e)null==t||t.classList.remove(m.ButtonGroupVertical),null==t||t.classList.add(m.ButtonGroup)}super.connectedCallback(),this.addEventSubscription()}disconnectedCallback(){this.removeEventListener("pointerdown",this.boundButtonOnPointerDownHandler),this.buttonObserver.disconnect(),this.stopPointerLongTap(),super.disconnectedCallback()}onSlotChanged(e){super.onSlotChanged(e),this.buttonObserver.observe(this,{childList:!0})}addEventSubscription(){this.addEventListener("pointerdown",this.boundButtonOnPointerDownHandler)}registerButton(e){this.hasSpinBtnClass(e)&&e.addEventListener("pointerdown",this.boundButtonOnPointerDownHandler)}unregisterButton(e){this.hasSpinBtnClass(e)&&(e.removeEventListener("pointerup",this.boundButtonOnPointerUpHandler),e.removeEventListener("pointerout",this.boundButtonOnPointerUpHandler),e.removeEventListener("pointerdown",this.boundButtonOnPointerDownHandler))}onTextInput(e){if(this.isServerMask)return;if(!this.inputElement||!i.containsInComposedPath(e,(e=>e===this.inputElement)))return;let t=this.fieldElementValue.trim();this.decimalSeparator&&(t=t.replace(/[.|,]/g,this.decimalSeparator)),this.regex.test(t)||(t=t.replace(/[^0-9]/g,"")),t!==this.fieldElementValue&&(this.fieldElementValue=t),super.onTextInput(e)}processKeyDown(e){const t=this.getFieldElement();return!!i.containsInComposedPath(e,(e=>e===t))&&(this.isNavigationKey(e)?(i.markHandled(e),this.incrementValue(e.keyCode===o.KeyCode.Up),!0):!!super.processKeyDown(e))}processWheel(e){this.incrementValue(e.deltaY<0)}onButtonPointerDown(e){const t=this.getButton(e);if(!t||!this.inputElement)return;e.preventDefault(),this.useAdaptiveLayout||n.DomUtils.setFocus(this.inputElement);const o=n.DomUtils.hasClassName(t,B.IncBtn);this.incrementValue(o),this.pointerDownTimer={id:window.setTimeout(this.startPointerLongTap.bind(this),1e3,o),button:t},t.addEventListener("pointerup",this.boundButtonOnPointerUpHandler),t.addEventListener("pointerout",this.boundButtonOnPointerUpHandler)}getButton(e){const t=e.composedPath();for(const e in t){const n=t[e];if(n&&this.hasSpinBtnClass(n))return n}return null}hasSpinBtnClass(e){return n.DomUtils.hasClassName(e,B.IncBtn)||n.DomUtils.hasClassName(e,B.DecBtn)}startPointerLongTap(e,t){this.pointerDownTimer={id:window.setInterval(this.incrementValue.bind(this),50,e),button:t}}stopPointerLongTap(){-1!==this.pointerDownTimer.id&&(clearTimeout(this.pointerDownTimer.id),this.pointerDownTimer={id:-1,button:null},this.raiseApplyValue())}onButtonPointerUp(e){let t=e.target;this.hasSpinBtnClass(t)||(t=n.DomUtils.getParentByTagName(t,"button")),this.stopPointerLongTap(),t.removeEventListener("pointerup",this.boundButtonOnPointerUpHandler),t.removeEventListener("pointerout",this.boundButtonOnPointerUpHandler)}buttonRemovedHandler(e,t){if(-1===this.pointerDownTimer.id)return;e.some((e=>Array.from(e.removedNodes).some((e=>{var t,o;return n.DomUtils.isElementNode(e)&&e.classList.contains(B.BtnsContainer)&&((null===(t=this.pointerDownTimer.button)||void 0===t?void 0:t.isEqualNode(n.DomUtils.getChildNodesByClassName(e,B.IncBtn)[0]))||(null===(o=this.pointerDownTimer.button)||void 0===o?void 0:o.isEqualNode(n.DomUtils.getChildNodesByClassName(e,B.DecBtn)[0])))}))))&&this.stopPointerLongTap()}incrementValue(e){this.dispatchEvent(new c(e,this.fieldElementValue))}isNavigationKey(e){return e.keyCode===o.KeyCode.Up||e.keyCode===o.KeyCode.Down}updated(e){super.updated(e),(e.has(f("decimalSeparator"))||e.has(f("needExponentialView")))&&this.applyRegex()}applyRegex(){this.decimalSeparator&&(this.regex=this.needExponentialView?/^-?(\d+|[,.]\d+|\d+[,.]\d+|\d+[,.]|[,.])?([eE]?[+-]?(\d)*)?$/:/^-?(\d+|[,.]\d+|\d+[,.]\d+|\d+[,.]|[,.])?$/)}shouldProcessKeyUp(e){switch(e.key){case"ArrowUp":case"ArrowDown":return this.maskProcessingMode!==d.None}return super.shouldProcessKeyUp(e)}}e([h({type:Boolean,attribute:w.allowMouseWheel})],y.prototype,"allowMouseWheel",void 0),e([h({type:Boolean,attribute:w.needExponentialView})],y.prototype,"needExponentialView",void 0),e([h({type:Boolean,attribute:w.useAdaptiveLayout})],y.prototype,"useAdaptiveLayout",void 0),e([h({type:String,attribute:w.decimalSeparator})],y.prototype,"decimalSeparator",void 0),customElements.define(r,y);const E={loadModule:function(){}};export{y as DxSpinEdit,B as SpinEditCssClasses,E as default};
