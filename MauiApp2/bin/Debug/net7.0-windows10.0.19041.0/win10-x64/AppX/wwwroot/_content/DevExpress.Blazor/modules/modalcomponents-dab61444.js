import{_ as e}from"./_tslib-6e8ca86b.js";import{a as t,F as s,S as n,c as i}from"./capturemanager-63058346.js";import{v as o,T as a,k as r,V as l,l as d,m as c,n as h,B as u,j as p,o as b,p as m,q as g,f,Z as w,r as y}from"./popup-1940fd5f.js";import{BranchActivatedEvent as v,BranchIdContext as I,BranchRefreshedEvent as C}from"./branch-bf06b0d2.js";import{d as E,b as S}from"./dom-25ebd160.js";import{C as T}from"./css-classes-f3f8ed66.js";import{D}from"./layouthelper-910ca836.js";import{L as x}from"./logicaltreehelper-ec583f1d.js";import{n as R}from"./nameof-factory-64d95f5b.js";import{C as F}from"./custom-events-helper-18f7786a.js";import{e as k}from"./property-d3853089.js";import{e as B}from"./custom-element-267f9a21.js";import{y as H,s as O}from"./lit-element-70cf14f4.js";import{D as L,a as j}from"./popupportal-d99ac31f.js";import"./eventhelper-8570b930.js";import"./rect-6159d026.js";import"./point-37917280.js";import"./rafaction-bba7928b.js";import"./transformhelper-ebad0156.js";import"./positiontracker-eebf89fe.js";import"./data-qa-utils-8be7c726.js";import"./dx-ui-element-39d22b67.js";import"./lit-element-base-c6695e09.js";const A=new class{constructor(){this._shadowBranchEvent=new t,this._topShadowId=null,this.shadowSet=new Set}get shadowBranchChanged(){return this._shadowBranchEvent}register(e){this.shadowSet.add(e),this.raiseTopShadowStackChanged()}unregister(e){this.shadowSet.delete(e),this.raiseTopShadowStackChanged()}raiseTopShadowStackChanged(){const e=this.getTopShadowModal();if(this._topShadowId===e)return;this._topShadowId=e;this._shadowBranchEvent.raise({branch:e})}getTopShadowModal(){let e=-1,t="";for(const s of Array.from(this.shadowSet)){const n=o.getIndex(s);n>e&&(e=n,t=s)}return t}},K=T.Prefix+"-prevent-safari-scrolling";const q=new class{constructor(){this.paddingCoerced=!1,this.bodyScrollTop=0,this.bodyScrollPadding="",this.scrollLocked=!1,this.scrollLockHostSet=new Set}register(e){this.scrollLockHostSet.add(e),this.updateScrollLock()}unregister(e){this.scrollLockHostSet.delete(e),this.updateScrollLock()}updateScrollLock(){this.toggleBodyScroll(document.body,this.scrollLockHostSet.size>0)}toggleBodyScroll(e,t){t!==this.scrollLocked&&(this.scrollLocked=t,this.toggleScrollPadding(e,t),E.DomUtils.toggleClassName(e,"dxbl-modal-open",t),S.Browser.Safari&&this.toggleSafariScroll(e,t))}toggleScrollPadding(e,t){if(t){const t=D.getVerticalScrollbarWidth();if(0===t)return;this.paddingCoerced=!0;const s=parseInt(getComputedStyle(document.body).getPropertyValue("padding-right"),10);return this.bodyScrollPadding=document.body.style.paddingRight,void(e.style.paddingRight=`${s+t}px`)}this.paddingCoerced&&(e.style.paddingRight=this.bodyScrollPadding,this.paddingCoerced=!1)}toggleSafariScroll(e,t){t?(this.bodyScrollTop=window.pageYOffset,E.DomUtils.toggleClassName(e,K,t)):(E.DomUtils.toggleClassName(e,K,t),window.scrollTo(0,this.bodyScrollTop))}},P=["a[href]","audio[controls]","button",'[contenteditable]:not([contenteditable="false"])',"details>summary:first-of-type","details","input","select","textarea","[tabindex]","video[controls]"].join(",");class z{static getTabbables(e,t){const s=this.findTabbables(e,t),n=[],i=[];return s.forEach(((e,t)=>{const s=z.getTabIndex(e);0===s?n.push(e):i.push({index:t,tabIndex:s,item:e})})),i.sort(((e,t)=>e.tabIndex===t.tabIndex?e.index-t.index:e.tabIndex-t.tabIndex)).map((e=>e.item)).concat(n)}static findTabbables(e,t){const s=Array.from(e.querySelectorAll(P));return(t&&e.matches(P)||e.webkitMatchesSelector(P))&&s.unshift(e),s.filter(z.filterTabbable)}static filterTabbable(e){return!e.disabled&&(!z.isHiddenInput(e)&&(!z.isHidden(e)&&!(z.getTabIndex(e)<0)))}static getTabIndex(e){const t=e.getAttribute("tabindex");if(t){const e=parseInt(t,10);if(!isNaN(e))return e}return"true"===e.contentEditable||e.nodeName===a.audio||e.nodeName===a.video||e.nodeName===a.details?0:e.tabIndex}static isHiddenInput(e){return e.tagName===a.input&&e.getAttribute("type")===r.hidden}static isHidden(e){if(window.getComputedStyle(e).visibility===l.hidden)return!0;let t=e;for(;t;){if(window.getComputedStyle(e).display===d.none)return!0;t=t.parentElement}return!1}}class N{constructor(e){this.action=null,this.postponeAction=e}executePostpone(e){this.action=null,this.postponeAction()?e():this.action=e}execute(){this.action&&this.postponeAction()&&this.executeForce()}executeForce(){this.action&&this.action(),this.clear()}clear(){this.action=null}}const _=new class{constructor(){this.element=null,this.tabbables=[],this.lastFocusedElement=null,this.mutationObserver=new MutationObserver(this.handleMutations.bind(this)),this.focusPostponedAction=new N((()=>{var e,t;return null!==(t=(null===(e=this.tabbables)||void 0===e?void 0:e.length)>0)&&void 0!==t&&t})),this.documentFocusInHandler=this.documentFocusIn.bind(this),this.documentKeyDownHandler=this.documentKeyDown.bind(this),this.firstInnerElementKeyDownHandler=this.firstInnerElementKeyDown.bind(this),this.lastInnerElementKeyDownHandler=this.lastInnerElementKeyDown.bind(this),this.handleFocusOutHandler=this.handleFocusOut.bind(this),this.firstInnerElement=null,this.lastInnerElement=null}activate(e){if(this.element="string"==typeof e?document.querySelector(e):e,null===this.element)throw"element is null";this.lastFocusedElement=document.activeElement,this.subscribe(this.element),this.tabbables=z.getTabbables(this.element,!0),this.updateInnerElements(),this.subscribeInnerElementsKeyDown(),this.focusPostponedAction.executePostpone(this.forceFocusFirstElement.bind(this)),this.mutationObserver.observe(this.element,{subtree:!0,childList:!0})}deactivate(e){this.element&&(this.focusPostponedAction.clear(),this.mutationObserver.disconnect(),this.unsubscribeDocument(),this.unsubscribe(this.element),this.unsubscribeInnerElementsKeyDown(),e&&!x.containsElement(this.element,document.activeElement)&&this.lastFocusedElement&&s.restoreFocus(this.lastFocusedElement),this.element=null,this.lastFocusedElement=null,clearTimeout(this.updateTabbablesTimerID))}forceFocusFirstElement(){const e=this.tabbables[0];e&&(this.lastFocusedElement&&this.element&&x.containsElement(this.element,document.activeElement)||s.restoreFocus(e))}handleMutations(e){clearTimeout(this.updateTabbablesTimerID),this.updateTabbablesTimerID=setTimeout((()=>{this.tabbables=z.getTabbables(this.element,!0),this.unsubscribeInnerElementsKeyDown(),this.updateInnerElements(),this.subscribeInnerElementsKeyDown(),this.focusPostponedAction.execute()}),50)}subscribe(e){this.element.addEventListener("focusout",this.handleFocusOutHandler,!0)}unsubscribe(e){this.element.removeEventListener("focusout",this.handleFocusOutHandler,!0)}handleFocusOut(e){const t=e.relatedTarget;t?this.element.contains(t)||this.focusPostponedAction.executePostpone(this.forceFocusFirstElement.bind(this)):this.subscribeDocument()}subscribeDocument(){document.addEventListener("focusin",this.documentFocusInHandler),document.addEventListener("keydown",this.documentKeyDownHandler)}unsubscribeDocument(){document.removeEventListener("keydown",this.documentKeyDownHandler),document.removeEventListener("focusin",this.documentFocusInHandler)}documentKeyDown(e){var t;const s=e.target;if(s&&(this.element===s||(null===(t=this.element)||void 0===t?void 0:t.contains(s))))return;const n=this.element;n&&n.processKeyDown(e)}documentFocusIn(e){const t=e.target;if(!t)return;this.unsubscribeDocument();const s=e.relatedTarget;(s||this.element.contains(t))&&(!s||this.element.contains(s))||this.focusPostponedAction.executePostpone(this.forceFocusFirstElement.bind(this))}firstInnerElementKeyDown(e){var t;this.firstInnerElement===document.activeElement&&"Tab"===e.key&&e.shiftKey&&(e.preventDefault(),null===(t=this.lastInnerElement)||void 0===t||t.focus({preventScroll:!1}))}lastInnerElementKeyDown(e){var t;this.lastInnerElement!==document.activeElement||"Tab"!==e.key||e.shiftKey||(e.preventDefault(),null===(t=this.firstInnerElement)||void 0===t||t.focus({preventScroll:!1}))}unsubscribeInnerElementsKeyDown(){var e,t;null===(e=this.firstInnerElement)||void 0===e||e.removeEventListener("keydown",this.firstInnerElementKeyDownHandler),null===(t=this.lastInnerElement)||void 0===t||t.removeEventListener("keydown",this.lastInnerElementKeyDownHandler)}subscribeInnerElementsKeyDown(){var e,t;null===(e=this.firstInnerElement)||void 0===e||e.addEventListener("keydown",this.firstInnerElementKeyDownHandler),null===(t=this.lastInnerElement)||void 0===t||t.addEventListener("keydown",this.lastInnerElementKeyDownHandler)}updateInnerElements(){this.tabbables&&(this.firstInnerElement=this.tabbables[0],this.lastInnerElement=this.tabbables[this.tabbables.length-1])}},V="dxbl-modal",M=R();class ${constructor(e){this.closeReason=e}}class Z extends CustomEvent{constructor(e){super(Z.eventName,{detail:new $(e),bubbles:!0,composed:!0,cancelable:!0})}}Z.eventName=V+".closingRequested",F.register(Z.eventName,(e=>e.detail));class U extends CustomEvent{constructor(e){super(U.eventName,{detail:new $(e),bubbles:!0,composed:!0,cancelable:!0})}}U.eventName=V+".closingResultRequested",F.register(U.eventName,(e=>e.detail));let W=class extends c{constructor(){super(...arguments),this._positionChangedEvent=new n,this.shadowSlotChangedHandler=this.handleShadowSlotChange.bind(this),this.topShadowBranchChangedHandler=this.handleTopShadowBranchChanged.bind(this),this.shadow=null,this.closingResultRequestedTcs=new h,this.shownCompletedTcs=new h,this.popupDialog=null,this._zIndex=0,this.modal=null,this.shadingChangedEvent=new t,this._isOpen=!1,this.shading=!1,this.closeOnOutsideClick=!1,this.closeOnEscape=!1,this.autoZIndex=!1,this.zIndex=0,this.shadowVisible=!1,this.topShadowBranchId=null,this.hasServerSideClosing=!1,this.disableFocusTrap=!1}get positionChanged(){return this._positionChangedEvent}get renderedVisible(){return!0}get isOpen(){return this._isOpen}get branchType(){return u.Modal}get preventInteractions(){return!0}render(){return H`
            <dxbl-branch
                id="branch"
                branch-id="${this.branchId}"
                type="${this.branchType}">
                ${this.renderShadow()}
                ${this.renderDefaultSlot()}
            </dxbl-branch>
        `}renderDefaultSlot(){return H`<slot></slot>`}renderShadow(){return H`<slot name="shadow" @slotchange="${this.shadowSlotChangedHandler}"></slot>`}handleShadowSlotChange(e){const t=e.target.assignedNodes();this.shadow=t.find((e=>e instanceof HTMLElement))}get shadingChanged(){return this.shadingChangedEvent}connectedCallback(){super.connectedCallback(),this.subscribeToEvents()}disconnectedCallback(){super.disconnectedCallback(),this.unsubscribeFromEvents(),this.close()}show(){return this.isOpen||(this._isOpen=!0,this.initializeCapture(),this.initializeBodyScrollLock(),this.addToVisibleBranchTree()),this.shownCompletedTcs.promise}close(){this.isOpen&&(this._isOpen=!1,this.releaseCapture(),this.releaseBodyScrollLock(),this.removeFromVisibleBranchTree())}willUpdate(e){this.shadowVisible=this.shading&&this.isOpen&&!!this.branchId&&this.branchId===this.topShadowBranchId}updated(e){this.shadow&&e.has(M("shadowVisible"))&&(this.shadow.style.display=this.shadowVisible?d.block:d.none),e.has(M("zIndex"))&&(this.style.zIndex=this.autoZIndex?"":String(this.zIndex),this.raiseZIndexChange())}ensureBranchId(){if(!this.branchId)throw new Error("branchId should not be null")}addToVisibleBranchTree(){this.ensureBranchId(),o.register(this.branchId),A.register(this.branchId),this.raiseBranchRefreshed()}removeFromVisibleBranchTree(){this.ensureBranchId(),o.unregister(this.branchId),A.unregister(this.branchId),this.raiseBranchRefreshed()}initializeBodyScrollLock(){q.register(this.branchId)}releaseBodyScrollLock(){q.unregister(this.branchId)}subscribeToEvents(){A.shadowBranchChanged.subscribe(this.topShadowBranchChangedHandler)}unsubscribeFromEvents(){A.shadowBranchChanged.unsubscribe(this.topShadowBranchChangedHandler)}handleTopShadowBranchChanged(e){this.topShadowBranchId=e.branch}initializeCapture(){i.capture(this)}releaseCapture(){this.processClosingRequested(!0),i.releaseCapture(this)}processClosingRequested(e){this.closingResultRequestedTcs.resolve(e),this.closingResultRequestedTcs=new h}notifyDialogConnected(e){this.popupDialog=e,this.initializeFocusTrap()}notifyRootConnected(){requestAnimationFrame((()=>{setTimeout((()=>{this.shownCompletedTcs.tryResolve()}))}))}notifyDialogDisconnected(){this.popupDialog=null,this.initializeFocusTrap()}notifyRootDisconnected(){this.shownCompletedTcs.tryReject("cancelled"),this.shownCompletedTcs=new h}gotCapture(){super.gotCapture(),this.activate(),this.initializeFocusTrap()}lostCapture(){super.lostCapture(),this.releaseFocusTrap()}initializeFocusTrap(){this.isOpen&&this.popupDialog&&!this.disableFocusTrap&&_.activate(this.popupDialog)}releaseFocusTrap(){_.deactivate(!this.isOpen)}activate(){const e=new v(new I(this.branchId));this.dispatchEvent(e)}notifyCloseCanceled(){this.processClosingRequested(!1)}async processCapturedPointerDownAsync(e,t){t.handled||p.containsInComposedPath(e,this.popupDialog)||(t.nextInteractionHandled=!0,await b.processCapturedPointerDown(this,e,t))}async processCapturedKeyDownAsync(e,t){t.handled||this.closeOnEscape&&"Escape"===e.key&&await this.processEscape(e,t)}async processEscape(e,t){const s=await this.raiseClosingResultRequestedAsync(m.EscapePress);this.closingResultRequestedTcs=new h,s||(t.handled=!0)}async closeAsync(e,t){const s=await this.raiseClosingResultRequestedAsync(t);return this.closingResultRequestedTcs=new h,e.nextInteractionHandled=!0,e.handled=!0,Promise.resolve(!!s)}async closeHierarchyAsync(e,t,s){for(const e of o.iterateBranch(this.branchId)){const n=await g().getPopup(e);await(null==n?void 0:n.closeAsync(t,s))}await this.closeAsync(t,s)}async raiseClosingResultRequestedAsync(e){if(!this.hasServerSideClosing)return this.raiseClosingRequested(e),!0;const t=new h;return this.closingResultRequestedTcs=t,this.raiseClosingResultRequested(e),t.promise}raiseClosingRequested(e){this.dispatchEvent(new Z(e))}raiseClosingResultRequested(e){this.dispatchEvent(new U(e))}raiseBranchRefreshed(){const e=new C(new I(this.branchId));this.dispatchEvent(e)}raiseZIndexChange(){this.updateComplete.then((e=>{this.dispatchEvent(new f(new w(this.zIndex)))}))}};e([k({type:Boolean,attribute:"x-is-open",reflect:!0,converter:{fromAttribute:(e,t)=>{throw new Error("readonly")}}})],W.prototype,"_isOpen",void 0),e([k({type:Boolean,attribute:"shading"})],W.prototype,"shading",void 0),e([k({type:Boolean,attribute:"close-on-outside-click"})],W.prototype,"closeOnOutsideClick",void 0),e([k({type:Boolean,attribute:"close-on-escape"})],W.prototype,"closeOnEscape",void 0),e([k({type:Boolean,attribute:"auto-z-index"})],W.prototype,"autoZIndex",void 0),e([k({type:Number,attribute:"z-index"})],W.prototype,"zIndex",void 0),e([k({type:String,attribute:"branch-id"})],W.prototype,"branchId",void 0),e([k({reflect:!1})],W.prototype,"shadowVisible",void 0),e([k({reflect:!1})],W.prototype,"topShadowBranchId",void 0),e([k({type:Boolean,attribute:"has-serverside-closing"})],W.prototype,"hasServerSideClosing",void 0),e([k({type:Boolean,attribute:"disable-focus-trap"})],W.prototype,"disableFocusTrap",void 0),W=e([B(V)],W);const Y="dxbl-modal-dialog";let G=class extends L{constructor(){super(...arguments),this.popup=null}connectedCallback(){super.connectedCallback(),this.popup=this.closest(V),this.popup.notifyDialogConnected(this)}disconnectedCallback(){var e;super.disconnectedCallback(),null===(e=this.popup)||void 0===e||e.notifyDialogDisconnected(),this.popup=null}};G=e([B(Y)],G);const J="dxbl-modal-root";let Q=class extends O{constructor(){super(...arguments),this.slotChangedHandler=this.handleSlotChange.bind(this)}render(){return H`
            <slot @slotchange=${this.slotChangedHandler}></slot>
        `}handleSlotChange(e){const t=e.target.assignedNodes().find((e=>e instanceof G)),s=this.closest(V);s&&(t?(s.notifyDialogConnected(t),s.notifyRootConnected()):(s.notifyDialogDisconnected(),s.notifyRootDisconnected()))}};Q=e([B(J)],Q);const X=[Y,V,J,y,j];function ee(e){if(!e)throw new Error("failed");return e}const te={getReference:ee,registeredComponents:X};export{te as default,ee as getReference,X as registeredComponents};
